<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Pesquisas de Preços de Combustíveis em Joinville/SC</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="/libs/tools.js"></script>
    </head>

  <body>
    <h1 class="text-center">Dados do Posto Selecionado</h1>

    <p class="container text-muted"> Posto {{ dados_posto.id }} - {{ dados_posto.nome }} </p> 
    <p class="container text-muted"> Endereço: <a href="http://www.google.com/maps?q={{ dados_posto.endereco | replace(".", "") }}-Joinville">{{ dados_posto.endereco }}</a> - {{ dados_posto.bairro }} </p>


    <h2 class="text-center">Histórico de Preços do Posto </h2>

    <div class="container-fluid text-center">

      <div class="row justify-content-md-center">
        <!-- coluna da esquerda -->
        <div class="col-md-6">
          <table class="table-responsive table container text-center" id="tabelaPrecos">
            <tr>
              <th>Data</th>
              <th>Gasolina comum</th>
              <th>Gasolina aditivada</th>
              <th>Etanol</th>
              <th>Diesel</th>
              <th>GNV</th>
            </tr>

            {% for posto in dados_historico_posto %}
            <tr>
              <td> {{ posto.data }} </td>
              <td> {{ '%.2f' % posto.gasolina_comum if posto.gasolina_comum else '---' }} </td>
              <td> {{ '%.2f' % posto.gasolina_aditivada if posto.gasolina_aditivada else '---'}} </td>
              <td> {{ '%.2f' % posto.etanol if posto.etanol else '---'}} </td>
              <td> {{ '%.2f' % posto.diesel if posto.diesel else '---' }} </td>
              <td> {{ '%.2f' % posto.GNV if posto.GNV else '---' }} </td>
            </tr>
            {% endfor %}

          </table>
        </div>

        <!-- coluna da direita -->
        <div class="col-md-6">
          <canvas id="graficoPrecos"></canvas>
        </div>
      </div>
    </div>
    <footer>
      © 2025- <a href="mailto:renan.birck.pinheiro@gmail.com">Renan Birck Pinheiro</a> - <a href="https://github.com/renanbirck/gasolina">GitHub</a>
    </footer>
  </body>


  <!-- Gerar gráficos, depois que a página já estiver montada-->

  <script>

    // construir as linhas a serem plotadas no gráfico.  

    // como a maioria dos postos só vende gasolinas, etanol, diesel e GNV,
    // acho bem razoável presumir que não irá ter novas colunas. Talvez 
    // se no futuro os postos virarem eletropostos, será necessário atualizar.

    // 1. Pegar as etiquetas de cada gráfico
    lineLabels = [...document.querySelectorAll("#tabelaPrecos th")].map((header) => header.innerHTML);
    console.log(lineLabels)

    // 2. Pegar as datas 

    dateLabels = getTableColumn("tabelaPrecos", 0).slice(1).map((dateLabel) => dateLabel.trim()); 
    console.log(dateLabels)

    // 3. Construir o array com os datasets 

    datasets = [];

    for(currentChart = 1; currentChart < lineLabels.length; currentChart++) {
      currentDataset = {
        label: lineLabels[currentChart],
        data: getTableColumn("tabelaPrecos", currentChart).slice(1).map((value) => parseFloat(value)),
        borderWidth: 1
      }

      datasets.push(currentDataset);
    }


    const ctx = document.getElementById('graficoPrecos');
    new Chart(ctx, {
      type: 'line',
      data: {
        labels: dateLabels,
        datasets: datasets
      },
      options: {
        scales: {
          y: {
            beginAtZero: false
          }
        }
      }
    });
  </script>

 

 
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
</html>
